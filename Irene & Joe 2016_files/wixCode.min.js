define("wixCode/widgets/RemoteWidgetHandlerProxy",["lodash","RemoteModelInterface"],function(a,b){"use strict";function d(){for(;!a.isEmpty(this._messageQueue);){var b=this._messageQueue.shift();this._postMessageDelegate(this._wixCodeWidget,b)}}function e(a){this._postMessageDelegate?this._postMessageDelegate(this._wixCodeWidget,a):this._messageQueue.push(a)}function f(b,c,d){switch(c){case"data":this._siteDAL.setCompData(b,d);break;case"state":this._siteDAL.setCompState(b,d);break;case"props":this._siteDAL.setCompProps(b,d);break;case"events":this._siteDAL.addActionsAndBehaviors(b,d);break;case"layout":this._siteDAL.updateCompLayout(b,d)}a.isFunction(this._onUpdateCallback)&&this._onUpdateCallback()}function g(a,b,c){this._siteDAL=a,this._wixCodeWidget=b,this._postMessageDelegate=null,this._remoteModelInterfaces={},this._messageQueue=[],this._onUpdateCallback=c}var c={State:"stateChanged",Data:"dataChanged",Props:"propsChanged",Event:"registerEvent",Layout:"layoutChanged"};return g.prototype.registerPostMessageDelegate=function(a){this._postMessageDelegate=a,d.call(this)},g.prototype.initWidgets=function(c,d,g){this.remoteModelInterface=new b(void 0,f.bind(this)),a.forEach(d,function(a){this.remoteModelInterface.addComponent(a,{compName:this._siteDAL.getCompName(a),type:this._siteDAL.getCompType(a),state:this._siteDAL.getCompState(a),data:this._siteDAL.getCompData(a),props:this._siteDAL.getCompProps(a),layout:this._siteDAL.getCompLayout(a),events:this._siteDAL.getActionsAndBehaviors(a)})},this);var h={intent:"WIX_CODE",type:"init_widgets",pageId:c,rmiArguments:{widgetInstanceId:g,widgetData:this.remoteModelInterface.toJson()}};e.call(this,h)},g.prototype.updateComponent=function(a){this._postMessageDelegate&&e.call(this,a)},g.prototype.onCommand=function(a){switch(a.command){case c.State:this.remoteModelInterface.setState(a.compName,a.data);break;case c.Data:this.remoteModelInterface.setData(a.compName,a.data);break;case c.Layout:this.remoteModelInterface.setLayout(a.compName,a.data);break;case c.Props:this.remoteModelInterface.setProps(a.compName,a.data);break;case c.Event:this.remoteModelInterface.registerEvent(a.widgetInstanceId,a.compName,a.data.action.name,a.data.behavior.params.callbackId)}},g.prototype.handleEvent=function(a,b,c){var d;switch(b){case"runCode":d={intent:"WIX_CODE",type:"wix_code_run_user_function",widgetInstanceId:a,callbackId:c.callbackId,compName:c.compName}}e.call(this,d)},g}),define("wixCode/utils/wixCodeClientSpecMapService",["lodash"],function(a){"use strict";var b=function(b){return a.find(b,{type:"siteextension"})},c=function(a){return!!b(a)},d=function(a){return"wixCodeWidget_"+b(a).applicationId},e=function(a){return"wixCodeDataProvider_"+b(a).applicationId};return{getHandlerId:e,getWidgetInstanceId:d,hasWixCodeWidgetSpecs:c}}),define("wixCode/components/wixCodeWidget",["lodash","reactDOM","skins","core","wixCode/widgets/RemoteWidgetHandlerProxy","wixCode/utils/wixCodeClientSpecMapService","tpa","utils"],function(a,b,c,d,e,f,g,h){"use strict";var i=d.compRegistrar,j=d.compMixins,k=function(a){var b=a.wixCloudBaseDomain;return b&&"/"!==b.substr(-1)&&(b+="/"),b},l={mixins:[j.skinBasedComp,g.tpaMixins.tpaCompApi,g.tpaMixins.tpaUrlBuilder],getSkinProperties:function(){var b,a=this.buildUrl(this.getBaseUrl());return b=this.shouldClientSpecMapBeReloaded()?this.isClientSpecMapReloaded()?this._getSkinPropsWithIframe(a):{"":{},iframe:{}}:this._getSkinPropsWithIframe(a)},_getSkinPropsWithIframe:function(a){return{"":{},iframe:{src:a,key:a}}},componentWillMount:function(){var a=this.props.siteAPI.getDAL(),b=this.props.siteAPI.getSiteAspect("wixCodeWidgetAspect"),c=this.props.siteAPI.getSiteAspect("WidgetAspect"),d=this.props.siteAPI.getSiteData().getClientSpecMap(),g=f.getHandlerId(d),h=f.getWidgetInstanceId(d),i=new e(a,this,function(){b.updateSite()});c.registerWidgetHandler(g,i),c.registerWidgetInstance(h,g)},getBaseUrl:function(){var a=this.getAppData(),b=a.extensionId,c=this.props.siteData.serviceTopology,d="//"+b+".",e=k(c),f=this.props.siteData.isDebugMode()?"index.debug.html":"index.html",g="static/wixcode/target/"+f,i=this.props.siteData.santaBase;if(-1===i.indexOf(c.scriptsDomainUrl))return d+h.urlUtils.joinURL(e,g);var j=i.replace(c.scriptsDomainUrl,"");return d+h.urlUtils.joinURL(e,"_static",j,g)},mutateIframeUrlQueryParam:function(){function a(){if(void 0!==this.codeVersion)return this.codeVersion;var a=this.getAppData(),b=a.applicationId;return this.props.siteData.rendererModel.cloudVersions[b]}return{codeVersion:a.call(this)}}};return i.register("wysiwyg.viewer.classes.wixCode.WixCodeWidget",l),l}),define("wixCode/utils/wixCodeWidgetCollector",["lodash","utils","wixCode/utils/wixCodeClientSpecMapService"],function(a,b,c){"use strict";function f(c,d){var f=d.getPageData(c).structure,g=b.dataUtils.getAllCompsInStructure(f,d.isMobileView());return a(g).map("id").difference(e.concat(c)).value()}function g(a,b){var e=d.MASTER_PAGE_ID,g=a.getSiteData(),h=g.getClientSpecMap();if(c.hasWixCodeWidgetSpecs(h)){var i=f(b,g),j=f(e,g),k=a.getSiteAspect("WidgetAspect"),l=c.getWidgetInstanceId(h),m=c.getHandlerId(h);k.updateWidgetComponents(l,m,b,i),k.updateWidgetComponents(l,m,e,j)}}var d=b.siteConstants,e=[d.HEADER_ID,d.FOOTER_ID,d.PAGES_CONTAINER_ID,d.SITE_PAGES_ID],h={collectComponents:g};return h}),define("wixCode/aspects/WixCodeWidgetAspect",["lodash","core"],function(a,b){"use strict";function e(a){this._aspectSiteAPI=a}var c=function(a){return{componentType:"wysiwyg.viewer.classes.wixCode.WixCodeWidget",skin:"wysiwyg.viewer.skins.WixCodeWidgetSkin",type:"Component",id:a}},d=function(a,d,e){var f="wixCode_"+e.extensionId,g=c(f),h=b.componentPropsBuilder.getCompProps(g,a,null,d);return h.compData=e,b.compFactory.getCompClass(g.componentType)(h)};return e.prototype={getComponentStructures:function(){var b=this._aspectSiteAPI.getSiteData().getClientSpecMap(),d=this._getWixCodeWidgetsSpecs(b);return a.map(d,c)},getReactComponents:function(b){var c=this._aspectSiteAPI.getSiteData().getClientSpecMap(),e=this._aspectSiteAPI.getSiteAPI(),f=this._getWixCodeWidgetsSpecs(c);return a.map(f,a.partial(d,e,b))},_getWixCodeWidgetsSpecs:function(b){return a.filter(b,"type","siteextension")},updateSite:function(){this._aspectSiteAPI.forceUpdate()}},e}),define("wixCode/aspects/WixCodePostMessageAspect",["lodash","wixCode/utils/wixCodeClientSpecMapService"],function(a,b){"use strict";var c={"WIXֹֹֹ_CODE_MESSAGE":"WIX_CODE"},d={IFRAME_READY:"wix_code_iframe_loaded",IFRAME_COMMAND:"wix_code_iframe_command"},e=function(a){return a===c.WIXֹֹֹ_CODE_MESSAGE},f=function(a,c){var d=b.getHandlerId(c);return a.getWidgetHandler(d)},g=function(a,c){var e=f(this.widgetAspect,this.clientSpecMap);switch(a.type){case d.IFRAME_READY:var g=b.getWidgetInstanceId(this.clientSpecMap),h=c.getSiteAPI().getCurrentPageId(),i=this.widgetAspect.getWidgetComponents(g,h);e.initWidgets(h,i,g),e.registerPostMessageDelegate(this.sendPostMessage);break;case d.IFRAME_COMMAND:e.onCommand(a)}},h=function(b,c,d){var f;try{a.isString(c.data)?f=JSON.parse(c.data):a.isObject(c.data)&&(f=c.data)}catch(g){return}f&&e(f.intent)&&d.call(this,f,b)},i=function(a,b,c){a.postMessage||(a=a.contentWindow),a.postMessage(b,c||"*")},j=function(a){a.registerToMessage(this.handleMessage.bind(this)),this.siteAspectsSiteAPI=a,this.clientSpecMap=a.getSiteData().getClientSpecMap(),this.widgetAspect=a.getSiteAPI().getSiteAspect("WidgetAspect")};return j.prototype={handleMessage:function(a,b){h.call(this,this.siteAspectsSiteAPI,a,b||g)},sendPostMessage:function(a,b){var c=a.getIframe();if(!c)throw new Error("No iframe found in wixCode component",a);i(c,b)}},j}),define("wixCode/aspects/wixCodeAspectCollector",["core","wixCode/aspects/WixCodeWidgetAspect","wixCode/aspects/WixCodePostMessageAspect"],function(a,b,c){"use strict";var d=a.siteAspectsRegistry;d.registerSiteAspect("wixCodeWidgetAspect",b),d.registerSiteAspect("wixCodePostMessageAspect",c)}),define("wixCode",["core","wixCode/components/wixCodeWidget","wixCode/utils/wixCodeWidgetCollector","wixCode/aspects/wixCodeAspectCollector","wixCode/utils/wixCodeClientSpecMapService"],function(a,b,c,d,e){"use strict";return a.widgetCollectorRegistry.registerWidgetCollector(c),{wixCodeWidget:b,wixCodeClientSpecMapService:e}});